---
phase: 18-formatter-extensions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - filematcher/formatters.py
autonomous: true

must_haves:
  truths:
    - "format_group_prompt() returns a prompt string (not prints)"
    - "format_confirmation_status() prints checkmark for confirmed, X for skipped"
    - "format_remaining_count() prints remaining count message after 'a' response"
    - "JsonActionFormatter prompt methods are silent no-ops"
  artifacts:
    - path: "filematcher/formatters.py"
      provides: "Three new abstract methods and implementations"
      contains: "format_group_prompt"
  key_links:
    - from: "filematcher/formatters.py"
      to: "filematcher/colors.py"
      via: "dim, green, yellow imports"
      pattern: "from filematcher\\.colors import.*dim.*green.*yellow"
    - from: "TextActionFormatter.format_group_prompt"
      to: "_ACTION_PROMPT_VERBS"
      via: "Action enum lookup"
      pattern: "_ACTION_PROMPT_VERBS\\.get\\(Action\\("
---

<objective>
Extend ActionFormatter ABC with three new methods for interactive execution: `format_group_prompt()`, `format_confirmation_status()`, and `format_remaining_count()`.

Purpose: Establish formatter foundation for Phase 19's interactive execution loop. The formatter layer handles output formatting; the interactive logic (Phase 19) will call these methods.
Output: Updated formatters.py with new abstract methods and implementations in both TextActionFormatter and JsonActionFormatter.
</objective>

<execution_context>
@/Users/patrick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-formatter-extensions/18-CONTEXT.md
@.planning/phases/18-formatter-extensions/18-RESEARCH.md

@filematcher/formatters.py
@filematcher/colors.py
@filematcher/types.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add imports and constant mapping</name>
  <files>filematcher/formatters.py</files>
  <action>
Update the imports from filematcher.colors to include `dim`, `green`, `yellow` (currently only imports `red`, `cyan`, `bold_yellow`, `bold_green`).

Add the `_ACTION_PROMPT_VERBS` constant mapping after the existing `_ACTION_VERBS` dict (around line 731):

```python
_ACTION_PROMPT_VERBS = {
    Action.DELETE: "Delete duplicate?",
    Action.HARDLINK: "Create hardlink?",
    Action.SYMLINK: "Create symlink?",
}
```

This maps Action enum values to user-friendly verb phrases for the interactive prompt.
  </action>
  <verify>
```bash
grep -n "from filematcher.colors import" filematcher/formatters.py | grep -E "dim.*green.*yellow|green.*dim.*yellow"
grep -n "_ACTION_PROMPT_VERBS" filematcher/formatters.py
```
Both greps should find matches.
  </verify>
  <done>
- Import line includes `dim`, `green`, `yellow`
- `_ACTION_PROMPT_VERBS` constant exists with DELETE, HARDLINK, SYMLINK mappings
  </done>
</task>

<task type="auto">
  <name>Task 2: Add abstract methods to ActionFormatter ABC</name>
  <files>filematcher/formatters.py</files>
  <action>
Add three new abstract methods to the ActionFormatter ABC class (after the existing `finalize` method):

```python
@abstractmethod
def format_group_prompt(
    self,
    group_index: int,
    total_groups: int,
    action: str
) -> str:
    """Format the interactive prompt for a duplicate group.

    Args:
        group_index: Current group number (1-indexed)
        total_groups: Total number of groups
        action: Action type (delete, hardlink, symlink)

    Returns:
        Prompt string for input() call. Caller handles actual prompting.
    """
    ...

@abstractmethod
def format_confirmation_status(self, confirmed: bool) -> None:
    """Output confirmation symbol after user decision.

    Outputs on the SAME line as the prompt (user already typed response).
    - confirmed=True: green checkmark
    - confirmed=False: yellow X mark
    """
    ...

@abstractmethod
def format_remaining_count(self, remaining: int) -> None:
    """Output message after 'a' (all) response.

    Shows how many groups will be processed automatically.
    """
    ...
```

NOTE: `format_group_prompt()` RETURNS a string (for `input()` call) - different from most formatter methods that print directly.
  </action>
  <verify>
```bash
grep -A 5 "def format_group_prompt" filematcher/formatters.py | head -10
grep -A 3 "def format_confirmation_status" filematcher/formatters.py | head -6
grep -A 3 "def format_remaining_count" filematcher/formatters.py | head -6
```
All three methods should appear with @abstractmethod decorator.
  </verify>
  <done>
- ActionFormatter ABC has format_group_prompt() returning str
- ActionFormatter ABC has format_confirmation_status(confirmed: bool)
- ActionFormatter ABC has format_remaining_count(remaining: int)
- All three have @abstractmethod decorator
  </done>
</task>

<task type="auto">
  <name>Task 3: Implement methods in TextActionFormatter and JsonActionFormatter</name>
  <files>filematcher/formatters.py</files>
  <action>
Add implementations to TextActionFormatter (after `finalize` method):

```python
def format_group_prompt(
    self,
    group_index: int,
    total_groups: int,
    action: str
) -> str:
    """Format interactive prompt with progress and action verb."""
    verb = _ACTION_PROMPT_VERBS.get(Action(action), f"Process {action}?")
    progress = dim(f"[{group_index}/{total_groups}]", self.cc)
    return f"{progress} {verb} [y/n/a/q] "

def format_confirmation_status(self, confirmed: bool) -> None:
    """Output checkmark or X after user response."""
    if confirmed:
        print(green("\u2713", self.cc), end="")
    else:
        print(yellow("\u2717", self.cc), end="")
    print()  # Complete the line

def format_remaining_count(self, remaining: int) -> None:
    """Output message after 'a' (all) response."""
    print(f"Processing {remaining} remaining groups...")
```

Add no-op implementations to JsonActionFormatter (after existing no-ops around line 390):

```python
def format_group_prompt(
    self,
    group_index: int,
    total_groups: int,
    action: str
) -> str:
    # JSON mode never prompts interactively
    return ""

def format_confirmation_status(self, confirmed: bool) -> None:
    # No-op: JSON mode doesn't show inline status
    pass

def format_remaining_count(self, remaining: int) -> None:
    # No-op: JSON mode doesn't show inline messages
    pass
```

IMPORTANT:
- Only colorize the progress indicator `[3/10]`, keep the verb and options uncolored
- Use unicode checkmark U+2713 and X mark U+2717
- `format_confirmation_status()` must NOT add newline before the symbol (it goes on same line as prompt)
  </action>
  <verify>
```bash
python3 -c "from filematcher.formatters import TextActionFormatter, JsonActionFormatter; print('Import OK')"
python3 -c "
from filematcher.formatters import TextActionFormatter
from filematcher.colors import ColorConfig, ColorMode
f = TextActionFormatter(verbose=False, preview_mode=False, action='delete', color_config=ColorConfig(mode=ColorMode.NEVER))
prompt = f.format_group_prompt(3, 10, 'delete')
assert '[3/10]' in prompt, 'Missing progress'
assert 'Delete duplicate?' in prompt, 'Missing verb'
assert '[y/n/a/q]' in prompt, 'Missing options'
print('TextActionFormatter.format_group_prompt OK')
"
python3 -c "
from filematcher.formatters import JsonActionFormatter
f = JsonActionFormatter(verbose=False, preview_mode=False, action='delete')
prompt = f.format_group_prompt(3, 10, 'delete')
assert prompt == '', 'JsonActionFormatter should return empty string'
print('JsonActionFormatter.format_group_prompt OK')
"
```
All three commands should succeed.
  </verify>
  <done>
- TextActionFormatter.format_group_prompt returns prompt with progress, verb, options
- TextActionFormatter.format_confirmation_status prints colored checkmark/X
- TextActionFormatter.format_remaining_count prints "Processing N remaining groups..."
- JsonActionFormatter methods are no-ops (empty string / pass)
- No import errors when loading module
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

```bash
# Full test suite still passes
python3 run_tests.py

# Module loads without errors
python3 -c "from filematcher.formatters import ActionFormatter, TextActionFormatter, JsonActionFormatter"

# New methods exist and are callable
python3 -c "
from filematcher.formatters import TextActionFormatter
from filematcher.colors import ColorConfig, ColorMode
f = TextActionFormatter(color_config=ColorConfig(mode=ColorMode.NEVER))
print(f.format_group_prompt(1, 5, 'delete'))
f.format_confirmation_status(True)
f.format_remaining_count(4)
print('All methods work')
"
```
</verification>

<success_criteria>
1. formatters.py imports dim, green, yellow from colors module
2. _ACTION_PROMPT_VERBS constant maps Action values to prompt verbs
3. ActionFormatter ABC has 3 new @abstractmethod methods
4. TextActionFormatter implements all 3 methods with colored output
5. JsonActionFormatter implements all 3 methods as no-ops
6. All existing tests (241) still pass
7. Module imports successfully
</success_criteria>

<output>
After completion, create `.planning/phases/18-formatter-extensions/18-01-SUMMARY.md`
</output>
