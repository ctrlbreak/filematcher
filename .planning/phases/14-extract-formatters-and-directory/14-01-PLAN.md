---
phase: 14-extract-formatters-and-directory
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - filematcher/formatters.py
  - filematcher/__init__.py
  - file_matcher.py
autonomous: true

must_haves:
  truths:
    - "`from filematcher.formatters import ActionFormatter, TextActionFormatter, JsonActionFormatter` works"
    - "`from file_matcher import ActionFormatter, JsonActionFormatter` works (backward compat)"
    - "All 217 tests pass without modification"
  artifacts:
    - path: "filematcher/formatters.py"
      provides: "Output formatter classes and helpers"
      contains: "class ActionFormatter"
    - path: "filematcher/__init__.py"
      provides: "Direct import from formatters module"
      contains: "from filematcher.formatters import"
  key_links:
    - from: "filematcher/formatters.py"
      to: "filematcher.colors"
      via: "import for ColorConfig, color helpers"
      pattern: "from filematcher\\.colors import"
    - from: "filematcher/formatters.py"
      to: "filematcher.actions"
      via: "import for format_file_size"
      pattern: "from filematcher\\.actions import format_file_size"
    - from: "file_matcher.py"
      to: "filematcher.formatters"
      via: "import for backward compatibility"
      pattern: "from filematcher\\.formatters import"
---

<objective>
Extract output formatters to filematcher/formatters.py module.

Purpose: Continue package refactoring by extracting the output formatter classes (Strategy pattern) and their helper functions into a dedicated module.

Output: filematcher/formatters.py with ActionFormatter ABC, TextActionFormatter, JsonActionFormatter, SpaceInfo dataclass, and all formatting helper functions.
</objective>

<execution_context>
@/Users/patrick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-extract-formatters-and-directory/14-RESEARCH.md
@filematcher/__init__.py
@filematcher/colors.py
@filematcher/actions.py
@file_matcher.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filematcher/formatters.py</name>
  <files>filematcher/formatters.py</files>
  <action>
Create filematcher/formatters.py with:

1. Module docstring explaining purpose (output formatters for File Matcher)

2. Imports:
   - Python stdlib: abc.ABC, abc.abstractmethod, dataclasses.dataclass, datetime.datetime, datetime.timezone, json, os, shutil, sys, pathlib.Path
   - Internal: from filematcher.colors import (ColorMode, ColorConfig, GroupLine, red, cyan, bold_yellow, bold_green, green, yellow, dim, render_group_line, terminal_rows_for_line)
   - Internal: from filematcher.actions import format_file_size

3. Extract from file_matcher.py (copy entire implementations):
   - SpaceInfo dataclass (around line 78)
   - PREVIEW_BANNER constant
   - EXECUTE_BANNER constant
   - ActionFormatter ABC class (lines ~92-280) with ALL abstract methods and __init__
   - JsonActionFormatter class (lines ~282-634) - complete implementation
   - TextActionFormatter class (lines ~636-927) - complete implementation
   - format_group_lines() function (lines ~1099-1157)
   - format_duplicate_group() function (lines ~1159-1228)
   - format_confirmation_prompt() function (lines ~1230-1272)
   - format_statistics_footer() function (lines ~1274-1330)
   - calculate_space_savings() function (lines ~1332-1362)

4. Use `from __future__ import annotations` at top for type hints

5. DO NOT import from file_matcher.py - the module must be self-contained using only colors.py and actions.py

6. The module should be approximately 900-1000 lines (all formatter code)
  </action>
  <verify>
python3 -c "from filematcher.formatters import ActionFormatter, TextActionFormatter, JsonActionFormatter, SpaceInfo, PREVIEW_BANNER, EXECUTE_BANNER, format_group_lines, format_duplicate_group, format_confirmation_prompt, format_statistics_footer, calculate_space_savings; print('formatters.py imports OK')"
  </verify>
  <done>filematcher/formatters.py exists with all formatter classes and helper functions importable</done>
</task>

<task type="auto">
  <name>Task 2: Update imports and verify tests</name>
  <files>filematcher/__init__.py, file_matcher.py</files>
  <action>
1. Update filematcher/__init__.py:
   - Add direct import block after the actions import:
     ```python
     # Import from formatters submodule (extracted module)
     # This import depends on colors.py and actions.py
     from filematcher.formatters import (
         # Structured types
         SpaceInfo,
         # Constants
         PREVIEW_BANNER,
         EXECUTE_BANNER,
         # Formatter classes
         ActionFormatter,
         TextActionFormatter,
         JsonActionFormatter,
         # Formatting functions
         format_group_lines,
         format_duplicate_group,
         format_confirmation_prompt,
         format_statistics_footer,
         calculate_space_savings,
     )
     ```
   - Remove these names from __getattr__ lazy loader (they're now directly imported)

2. Update file_matcher.py:
   - Add import from filematcher.formatters for all extracted symbols
   - Remove the original definitions (SpaceInfo, PREVIEW_BANNER, EXECUTE_BANNER, ActionFormatter, JsonActionFormatter, TextActionFormatter, format_group_lines, format_duplicate_group, format_confirmation_prompt, format_statistics_footer, calculate_space_savings)
   - Keep the imports at top of file, remove ~850 lines of class/function definitions

3. Run full test suite to verify backward compatibility
  </action>
  <verify>
python3 run_tests.py 2>&1 | tail -5
  </verify>
  <done>All 217 tests pass, file_matcher.py reduced by ~850 lines, formatters imported from filematcher.formatters</done>
</task>

</tasks>

<verification>
1. `python3 -c "from filematcher.formatters import ActionFormatter, TextActionFormatter, JsonActionFormatter"` succeeds
2. `python3 -c "from file_matcher import ActionFormatter, JsonActionFormatter"` succeeds (backward compat)
3. `python3 run_tests.py` shows 217 tests pass with 0 failures
4. `wc -l filematcher/formatters.py` shows approximately 900-1000 lines
5. `wc -l file_matcher.py` shows approximately 1050-1100 lines (reduced from 1921)
</verification>

<success_criteria>
- filematcher/formatters.py exists with all formatter classes and functions
- Direct import in __init__.py (not lazy __getattr__)
- All 217 tests pass without modification
- file_matcher.py reduced by ~850 lines
- Both `from filematcher.formatters import X` and `from file_matcher import X` work
</success_criteria>

<output>
After completion, create `.planning/phases/14-extract-formatters-and-directory/14-01-SUMMARY.md`
</output>
