---
phase: 10-unify-compare-as-action
plan: 04
type: execute
wave: 4
depends_on: ["10-03"]
files_modified:
  - file_matcher.py
autonomous: true

must_haves:
  truths:
    - "CompareFormatter ABC deleted from codebase"
    - "TextCompareFormatter class deleted from codebase"
    - "JsonCompareFormatter class deleted from codebase"
    - "Dead else branch in main() deleted"
    - "No references to CompareFormatter in codebase"
  artifacts:
    - path: "file_matcher.py"
      provides: "Clean codebase with single formatter hierarchy"
      min_lines: 2100  # Reduced from ~2680 by ~500 lines
  key_links:
    - from: "main()"
      to: "ActionFormatter"
      via: "only formatter hierarchy"
      pattern: "ActionFormatter"
---

<objective>
Delete the CompareFormatter hierarchy and dead code, completing the unification.

Purpose: Remove ~500 lines of duplicate code that is no longer used after the action path unification.
Output: Clean codebase with single ActionFormatter hierarchy handling all modes.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-unify-compare-as-action/10-CONTEXT.md
@.planning/phases/10-unify-compare-as-action/10-RESEARCH.md
@.planning/phases/10-unify-compare-as-action/10-03-SUMMARY.md
@file_matcher.py (full file - deletion targets)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete CompareFormatter ABC</name>
  <files>file_matcher.py</files>
  <action>
Delete the CompareFormatter ABC class (lines ~215-322, approximately 108 lines).

This includes:
- class CompareFormatter(ABC): definition
- __init__ method
- All @abstractmethod declarations:
  - format_header
  - format_match_group
  - format_unmatched
  - format_summary
  - format_statistics
  - format_empty_result
  - format_unmatched_header
  - format_summary_line
  - finalize

Find the exact line range by searching for:
- Start: `class CompareFormatter(ABC):`
- End: The blank line before `class ActionFormatter(ABC):` (around line 324)

Delete the entire class definition.
  </action>
  <verify>Run: `grep -n "class CompareFormatter" file_matcher.py` - should return no results</verify>
  <done>CompareFormatter ABC deleted from codebase</done>
</task>

<task type="auto">
  <name>Task 2: Delete TextCompareFormatter class</name>
  <files>file_matcher.py</files>
  <action>
Delete the TextCompareFormatter class (approximately 154 lines).

**FIRST: Verify format_group_lines is safe to keep:**

Run: `grep -n "format_group_lines" file_matcher.py`

Expected output shows format_group_lines is:
1. A module-level function at line ~1281 (NOT inside TextCompareFormatter)
2. Called by TextCompareFormatter.format_match_group (line ~544) - will be deleted
3. Called by format_duplicate_group (line ~1372) - module-level function, still needed

Since format_group_lines is already a module-level function (added in quick-002), deleting TextCompareFormatter is safe. The function will remain and continue to be used by format_duplicate_group.

**Then proceed with deletion:**

Find the exact line range by searching for:
- Start: `class TextCompareFormatter(CompareFormatter):`
- End: The blank line before the next class (JsonCompareFormatter)

This includes all methods:
- __init__
- format_header
- format_match_group (calls format_group_lines - this is OK to delete)
- format_unmatched
- format_unmatched_header
- format_summary
- format_statistics
- format_summary_line
- format_empty_result
- finalize

Delete the entire class definition (~lines 473-627).
  </action>
  <verify>
Run verification commands:
1. `grep -n "class TextCompareFormatter" file_matcher.py` - should return no results
2. `grep -n "def format_group_lines" file_matcher.py` - should still show module-level function exists (~line 1100+ after deletions)
  </verify>
  <done>TextCompareFormatter class deleted; format_group_lines preserved as module-level function</done>
</task>

<task type="auto">
  <name>Task 3: Delete JsonCompareFormatter class</name>
  <files>file_matcher.py</files>
  <action>
Delete the JsonCompareFormatter class (approximately 166 lines).

Find the exact line range by searching for:
- Start: `class JsonCompareFormatter(CompareFormatter):`
- End: The blank line before the next class (likely JsonActionFormatter or another section)

This includes all methods:
- __init__
- format_header
- format_match_group
- format_unmatched
- format_unmatched_header
- format_summary
- format_statistics
- format_summary_line
- format_empty_result
- finalize

Delete the entire class definition.
  </action>
  <verify>Run: `grep -n "class JsonCompareFormatter" file_matcher.py` - should return no results</verify>
  <done>JsonCompareFormatter class deleted from codebase</done>
</task>

<task type="auto">
  <name>Task 4: Delete dead else branch in main()</name>
  <files>file_matcher.py</files>
  <action>
Delete the dead else branch that handled compare mode (approximately 74 lines):

Find by searching for:
- The `else:` clause after the large `if master_path:` block
- Contains comment: `# Original output format (no master mode / compare mode)`
- Includes JsonCompareFormatter and TextCompareFormatter instantiation
- Ends with `compare_formatter.finalize()`

Delete from the `else:` line through to just before `return 0`.

The code block to delete looks like:
```python
    else:
        # Original output format (no master mode / compare mode)
        if args.json:
            compare_formatter = JsonCompareFormatter(
                ...
            )
        ...
        compare_formatter.finalize()
```

After deletion, the `if master_path:` block should be the only path, but since master_path is now always set, consider removing the `if master_path:` condition entirely:

Before:
```python
    if master_path:
        # ... action mode code
    else:
        # ... compare mode code (now deleted)

    return 0
```

After:
```python
    # Action mode code handles all cases including compare
    # ... (former if body, now at same indentation)

    return 0
```

Wait - if the validation already prevents issues, we can keep `if master_path:` for now since it's always true. The dead else branch is what needs deletion.

Actually, cleaner to remove the `if master_path:` condition and unindent the block. But this is a larger refactor - can be done as cleanup or left as-is (condition is always True).

**For this plan:** Delete the else branch. The `if master_path:` can remain (always True is fine).
  </action>
  <verify>Run: `grep -n "JsonCompareFormatter\|TextCompareFormatter" file_matcher.py` - should return no results in main()</verify>
  <done>Dead else branch deleted; main() only has action path</done>
</task>

<task type="auto">
  <name>Task 5: Final verification and line count</name>
  <files>file_matcher.py</files>
  <action>
Verify the cleanup is complete:

1. Search for any remaining references:
   - `grep -n "CompareFormatter" file_matcher.py` - should find nothing
   - `grep -n "TextCompareFormatter" file_matcher.py` - should find nothing
   - `grep -n "JsonCompareFormatter" file_matcher.py` - should find nothing

2. Count lines to verify reduction:
   - `wc -l file_matcher.py` - should be ~2100-2200 lines (down from ~2680)
   - Expected reduction: ~480-500 lines

3. Run full test suite to ensure everything still works:
   - `python3 run_tests.py`

4. Test key scenarios manually:
   - `python file_matcher.py test_dir1 test_dir2` (default compare)
   - `python file_matcher.py test_dir1 test_dir2 --json`
   - `python file_matcher.py test_dir1 test_dir2 --action hardlink`
  </action>
  <verify>Run: `python3 run_tests.py && wc -l file_matcher.py` - all tests pass, line count reduced</verify>
  <done>Cleanup complete; ~500 lines removed; all tests pass; single formatter hierarchy</done>
</task>

</tasks>

<verification>
1. `grep "CompareFormatter" file_matcher.py` returns no matches
2. `wc -l file_matcher.py` shows ~2100-2200 lines (reduced from ~2680)
3. `python file_matcher.py test_dir1 test_dir2` works correctly
4. `python file_matcher.py test_dir1 test_dir2 --json` produces valid JSON
5. `python file_matcher.py test_dir1 test_dir2 --action hardlink` works correctly
6. `python3 run_tests.py` passes all 198 tests
</verification>

<success_criteria>
- No CompareFormatter, TextCompareFormatter, or JsonCompareFormatter in codebase
- Dead else branch in main() removed
- File reduced by ~500 lines (2680 -> ~2180)
- All 198 existing tests pass without modification
- All CLI functionality works correctly
</success_criteria>

<output>
After completion, create `.planning/phases/10-unify-compare-as-action/10-04-SUMMARY.md`
</output>
