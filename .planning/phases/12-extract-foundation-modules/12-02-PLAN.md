---
phase: 12-extract-foundation-modules
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - filematcher/hashing.py
  - filematcher/__init__.py
  - file_matcher.py
autonomous: true

must_haves:
  truths:
    - "`from filematcher.hashing import get_file_hash, get_sparse_hash` works"
    - "`from filematcher import get_file_hash, get_sparse_hash, create_hasher` works (re-exports)"
    - "`from file_matcher import get_file_hash, get_sparse_hash` works (backward compat)"
    - "All 217 tests pass unchanged"
  artifacts:
    - path: "filematcher/hashing.py"
      provides: "Hashing functions (create_hasher, get_file_hash, get_sparse_hash)"
      contains: "def get_file_hash"
      min_lines: 80
    - path: "filematcher/__init__.py"
      provides: "Re-exports from hashing.py"
      contains: "from filematcher.hashing import"
    - path: "file_matcher.py"
      provides: "Imports from filematcher.hashing instead of defining locally"
      contains: "from filematcher.hashing import"
  key_links:
    - from: "file_matcher.py"
      to: "filematcher/hashing.py"
      via: "import statement"
      pattern: "from filematcher\\.hashing import"
    - from: "filematcher/__init__.py"
      to: "filematcher/hashing.py"
      via: "re-export imports"
      pattern: "from filematcher\\.hashing import"
---

<objective>
Extract the hashing functions from file_matcher.py into filematcher/hashing.py as a leaf module with no internal dependencies.

Purpose: Second extraction of v1.4 package refactoring. Hashing module has zero dependencies on other filematcher code, making it an ideal leaf module.

Output: filematcher/hashing.py containing all hashing code, with re-exports maintaining backward compatibility.
</objective>

<execution_context>
@/Users/patrick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-extract-foundation-modules/12-RESEARCH.md
@.planning/phases/12-extract-foundation-modules/12-01-SUMMARY.md
@filematcher/__init__.py
@file_matcher.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filematcher/hashing.py with hashing functions</name>
  <files>filematcher/hashing.py</files>
  <action>
Create filematcher/hashing.py by extracting from file_matcher.py (approximately lines 2177-2284).

Must include (in order):
1. Module docstring explaining purpose
2. Future imports: `from __future__ import annotations`
3. Stdlib imports: hashlib, os, pathlib.Path
4. create_hasher function - creates hash object for md5 or sha256
5. get_file_hash function - calculates file hash with optional fast mode
6. get_sparse_hash function - sparse sampling hash for large files

Function signatures to preserve exactly:
- `def create_hasher(hash_algorithm: str = 'md5') -> hashlib._Hash`
- `def get_file_hash(filepath: str | Path, hash_algorithm: str = 'md5', fast_mode: bool = False, size_threshold: int = 100*1024*1024) -> str`
- `def get_sparse_hash(filepath: str | Path, hash_algorithm: str = 'md5', file_size: int | None = None, sample_size: int = 1024*1024) -> str`

Do NOT include:
- index_directory (depends on logging, stays in file_matcher.py)
- find_matching_files (depends on index_directory)
- Any color or formatting code

Verify no internal filematcher imports - only stdlib allowed.
  </action>
  <verify>
Run: `python3 -c "from filematcher.hashing import create_hasher, get_file_hash, get_sparse_hash"`
Must complete without ImportError.

Test functionality: `python3 -c "from filematcher.hashing import get_file_hash; print(get_file_hash('file_matcher.py')[:8])"`
Must print first 8 chars of hash.
  </verify>
  <done>filematcher/hashing.py exists with all hashing functions, imports successfully as standalone module</done>
</task>

<task type="auto">
  <name>Task 2: Update __init__.py and file_matcher.py imports</name>
  <files>filematcher/__init__.py, file_matcher.py</files>
  <action>
**Update filematcher/__init__.py:**
Add imports from filematcher.hashing (after the colors imports, before file_matcher imports):
```python
# Import from hashing submodule (new)
from filematcher.hashing import (
    create_hasher,
    get_file_hash,
    get_sparse_hash,
)
```

Update the `from file_matcher import` block to REMOVE the hashing functions (they now come from hashing.py):
- Remove: create_hasher, get_file_hash, get_sparse_hash

**Update file_matcher.py:**
At the top (after the filematcher.colors import), add:
```python
from filematcher.hashing import (
    create_hasher,
    get_file_hash,
    get_sparse_hash,
)
```

DELETE the original hashing function definitions from file_matcher.py (create_hasher, get_file_hash, get_sparse_hash - approximately lines 2177-2284 before colors extraction).

Keep index_directory and find_matching_files in file_matcher.py as they depend on the module-level logger.
  </action>
  <verify>
Run all tests: `python3 run_tests.py`
All 217 tests must pass.

Verify backward compatibility:
- `python3 -c "from file_matcher import get_file_hash, get_sparse_hash, create_hasher"`
- `python3 -c "from filematcher import get_file_hash, get_sparse_hash, create_hasher"`
Both must succeed.

Verify hashing tests specifically:
- `python3 -m tests.test_file_hashing`
- `python3 -m tests.test_fast_mode`
Both must pass.
  </verify>
  <done>
- filematcher/__init__.py imports from filematcher.hashing and re-exports all symbols
- file_matcher.py imports from filematcher.hashing instead of defining locally
- All 217 tests pass without modification
- Both import paths (file_matcher.X and filematcher.X) work
  </done>
</task>

</tasks>

<verification>
1. Hashing module imports standalone: `python3 -c "from filematcher.hashing import get_file_hash"`
2. Package re-exports work: `python3 -c "from filematcher import get_file_hash, get_sparse_hash, create_hasher"`
3. Backward compatibility: `python3 -c "from file_matcher import get_file_hash, get_sparse_hash"`
4. No circular imports: `python3 -c "import filematcher"` completes without error
5. Hashing tests pass: `python3 -m tests.test_file_hashing && python3 -m tests.test_fast_mode`
6. All tests pass: `python3 run_tests.py` returns 0 exit code
</verification>

<success_criteria>
- filematcher/hashing.py exists with all hashing functions (~100 lines)
- `from filematcher.hashing import get_file_hash, get_sparse_hash` works
- `from filematcher import get_file_hash, get_sparse_hash, create_hasher` works
- `from file_matcher import get_file_hash, get_sparse_hash` works
- All 217 tests pass without any modifications to test files
- No circular imports
</success_criteria>

<output>
After completion, create `.planning/phases/12-extract-foundation-modules/12-02-SUMMARY.md`
</output>
