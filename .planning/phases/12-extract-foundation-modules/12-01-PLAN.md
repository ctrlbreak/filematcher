---
phase: 12-extract-foundation-modules
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - filematcher/colors.py
  - filematcher/__init__.py
  - file_matcher.py
autonomous: true

must_haves:
  truths:
    - "`from filematcher.colors import ColorConfig, green, red` works"
    - "`from filematcher import ColorConfig, green, red, GREEN, RESET` works (re-exports)"
    - "`from file_matcher import ColorConfig, GREEN, strip_ansi` works (backward compat)"
    - "All 217 tests pass unchanged"
  artifacts:
    - path: "filematcher/colors.py"
      provides: "Color system (ColorMode, ColorConfig, ANSI constants, helpers)"
      contains: "class ColorConfig"
      min_lines: 150
    - path: "filematcher/__init__.py"
      provides: "Re-exports from colors.py"
      contains: "from filematcher.colors import"
    - path: "file_matcher.py"
      provides: "Imports from filematcher.colors instead of defining locally"
      contains: "from filematcher.colors import"
  key_links:
    - from: "file_matcher.py"
      to: "filematcher/colors.py"
      via: "import statement"
      pattern: "from filematcher\\.colors import"
    - from: "filematcher/__init__.py"
      to: "filematcher/colors.py"
      via: "re-export imports"
      pattern: "from filematcher\\.colors import"
---

<objective>
Extract the color system from file_matcher.py into filematcher/colors.py as a leaf module with no internal dependencies.

Purpose: First extraction of v1.4 package refactoring. Colors module has zero dependencies on other filematcher code, making it an ideal candidate for first extraction.

Output: filematcher/colors.py containing all color-related code, with re-exports maintaining backward compatibility.
</objective>

<execution_context>
@/Users/patrick/.claude/get-shit-done/workflows/execute-plan.md
@/Users/patrick/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-extract-foundation-modules/12-RESEARCH.md
@filematcher/__init__.py
@file_matcher.py (lines 32-345 for color system)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create filematcher/colors.py with color system</name>
  <files>filematcher/colors.py</files>
  <action>
Create filematcher/colors.py by extracting from file_matcher.py lines 32-345.

Must include (in order):
1. Module docstring explaining purpose
2. Future imports: `from __future__ import annotations`
3. Stdlib imports: os, re, sys, dataclasses.dataclass, enum.Enum
4. ANSI constants: RESET, GREEN, YELLOW, RED, CYAN, BOLD, DIM, BOLD_GREEN, BOLD_YELLOW
5. ColorMode enum
6. ColorConfig class
7. GroupLine dataclass (used by render_group_line)
8. Terminal helpers: _ANSI_ESCAPE_PATTERN, strip_ansi, visible_len, terminal_rows_for_line
9. Color helper functions: colorize, green, yellow, red, cyan, dim, bold, bold_yellow, bold_green
10. render_group_line function
11. determine_color_mode function

Do NOT include:
- SpaceInfo dataclass (stays in file_matcher.py, used by formatting functions)
- Any formatters (ActionFormatter, TextActionFormatter, JsonActionFormatter)

Verify no internal filematcher imports - only stdlib allowed.
  </action>
  <verify>
Run: `python3 -c "from filematcher.colors import ColorConfig, ColorMode, green, red, RESET, GREEN, BOLD_GREEN, strip_ansi, visible_len, terminal_rows_for_line, GroupLine, render_group_line, determine_color_mode"`
Must complete without ImportError.
  </verify>
  <done>filematcher/colors.py exists with all color-related code, imports successfully as standalone module</done>
</task>

<task type="auto">
  <name>Task 2: Update __init__.py and file_matcher.py imports</name>
  <files>filematcher/__init__.py, file_matcher.py</files>
  <action>
**Update filematcher/__init__.py:**
Add imports from filematcher.colors BEFORE the file_matcher imports. The new import block should include:
```python
# Import from colors submodule (new)
from filematcher.colors import (
    # ANSI constants
    RESET,
    GREEN,
    YELLOW,
    RED,
    CYAN,
    BOLD,
    DIM,
    BOLD_GREEN,
    BOLD_YELLOW,
    # Classes
    ColorMode,
    ColorConfig,
    GroupLine,
    # Terminal helpers
    strip_ansi,
    visible_len,
    terminal_rows_for_line,
    # Color helpers
    colorize,
    green,
    yellow,
    red,
    cyan,
    dim,
    bold,
    bold_yellow,
    bold_green,
    render_group_line,
    determine_color_mode,
)
```

Update the `from file_matcher import` block to REMOVE the color-related symbols (they now come from colors.py).

Update __all__ to include ANSI constants: RESET, GREEN, YELLOW, RED, CYAN, BOLD, DIM, BOLD_GREEN, BOLD_YELLOW (tests import these directly).

**Update file_matcher.py:**
At the top (after future imports and before other imports), add:
```python
from filematcher.colors import (
    RESET, GREEN, YELLOW, RED, CYAN, BOLD, DIM, BOLD_GREEN, BOLD_YELLOW,
    ColorMode, ColorConfig, GroupLine,
    strip_ansi, visible_len, terminal_rows_for_line,
    colorize, green, yellow, red, cyan, dim, bold, bold_yellow, bold_green,
    render_group_line, determine_color_mode,
)
```

DELETE the original color system definitions (lines 32-345 approximately) from file_matcher.py since they now come from the import.

Keep SpaceInfo dataclass in file_matcher.py (not part of colors module).
  </action>
  <verify>
Run all tests: `python3 run_tests.py`
All 217 tests must pass.

Verify backward compatibility:
- `python3 -c "from file_matcher import ColorConfig, GREEN, RESET, strip_ansi, visible_len"`
- `python3 -c "from filematcher import ColorConfig, GREEN, RESET, strip_ansi, visible_len"`
Both must succeed.
  </verify>
  <done>
- filematcher/__init__.py imports from filematcher.colors and re-exports all symbols including ANSI constants
- file_matcher.py imports from filematcher.colors instead of defining locally
- All 217 tests pass without modification
- Both import paths (file_matcher.X and filematcher.X) work
  </done>
</task>

</tasks>

<verification>
1. Colors module imports standalone: `python3 -c "from filematcher.colors import ColorConfig"`
2. Package re-exports work: `python3 -c "from filematcher import ColorConfig, GREEN, strip_ansi"`
3. Backward compatibility: `python3 -c "from file_matcher import ColorConfig, GREEN, strip_ansi"`
4. No circular imports: `python3 -c "import filematcher"` completes without error
5. All tests pass: `python3 run_tests.py` returns 0 exit code
</verification>

<success_criteria>
- filematcher/colors.py exists with all color system code (~200 lines)
- `from filematcher.colors import ColorConfig, green, red` works
- `from filematcher import ColorConfig, GREEN, RESET` works
- `from file_matcher import ColorConfig, GREEN, strip_ansi` works
- All 217 tests pass without any modifications to test files
- No circular imports
</success_criteria>

<output>
After completion, create `.planning/phases/12-extract-foundation-modules/12-01-SUMMARY.md`
</output>
